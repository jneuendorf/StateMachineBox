(function(){var t,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},e=[].slice,i=function(t,n){function e(){this.constructor=t}for(var i in n)o.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},o={}.hasOwnProperty;window.StateMachineBox=function(){function t(t,n,i){var o,r,s,a,h;for(null==i&&(i={}),this.headline=n,this.options=i,this.closeButtonAction=i.closeButtonAction||"close",this.onClose=i.onClose,this.onOk=i.onOk,this.onCancel=i.onCancel,this.onNext=i.onNext,this.onPrev=i.onPrev,this.onChange=i.onChange,this.beforeClose=i.beforeClose,this.beforeNext=i.beforeNext,this.beforePrev=i.beforePrev,this.beforeChange=i.beforeChange,this.onFailure=i.onFailure,this.theme=i.theme||"default",this.locale=i.locale||"en",this.showNavigation=i.showNavigation||!1,this.container=i.container||$(document.body),this.data={},this.div=this.constructor._$cache.popup.clone(),this.overlay=this.constructor._$cache.overlay.clone(),null!=i.width&&null!=i.height&&this.div.css({width:i.width,height:i.height}),this.loader=null,this.bodyWidth=parseFloat(this.options.width)||800,this.bodyPadding={top:10,right:40,bottom:10,left:40},this._active=!1,t.target=this,this.stateMachineConfig=t,this.bodyWrapper=null,this.contents={},a=t.events,r=0,s=a.length;s>r;r++)o=a[r],null!=o.content&&(this.contents[o.to]=o.content);h=this,null==t.callbacks&&(t.callbacks={}),t.callbacks.onenterstate=function(){var t,n,i,o;return t=arguments[0],n=arguments[1],o=arguments[2],i=4<=arguments.length?e.call(arguments,3):[],console.log("onenterstate",arguments),h.beforeChange instanceof Function&&h.beforeChange(o)===!1?!1:(h.changeContent(t,n,o),!0)},StateMachine.create(t),this.constructor.registerPopup(this)}return t.MODES={SINGLE:"single",MANY:"many"},t.MODE=t.MODES.SINGLE,t.FADE_TIME=180,t.DEFAULT_CSS_CLASS="default",t.BUTTON_ACTIONS={OK:"CLOSE",CANCEL:"CANCEL",NEXT:"NEXT",PREV:"PREV"},t.BUTTONS={OK:'<div class="button ok">ok</div>',CANCEL:'<div class="button cancel">cancel</div>',NEXT:'<div class="button next">next</div>',PREV:'<div class="button prev">prev</div>'},t.ACTIONS={CLOSE:function(){return this.close()},OK:function(){return this.close(!0),this.onOk instanceof Function&&this.onOk(),this},CANCEL:function(){return this.close(!0),this.onCancel instanceof Function&&this.onCancel(),this},CHANGE:function(t){return this.change(t)},NEXT:function(){return this.next()},PREV:function(){return this.prev()}},t.BUTTON_COLORS=["#222222","#9FA39F","#B9BCB9","#D3D5D3"],t._popups=[],t._activePopup=null,t._$cache={popup:$('<div class="popup">\n    <div class="content">\n        <div class="close" />\n        <div class="loader" />\n        <div class="header">\n            <div class="headline" />\n        </div>\n        <div class="bodyWrapper" />\n        <div class="navigation" />\n        <div class="footer" />\n    </div>\n</div>'),overlay:$('<div class="popup overlay" />')},t.locale={},t.init=function(){return this.setLocale("en",{ok:"ok",cancel:"cancel",next:"next",prev:"previous"}),this.setLocale("de",{ok:"ok",cancel:"abbrechen",next:"weiter",prev:"zurÃ¼ck"}),this},t.getTopMost=function(){var t,n,e,i,o;for(o=this._popups,t=$(),n=0,e=o.length;e>n;n++)i=o[n],t=t.add(i.div);return o[t.index(t.filter(":visible:last"))]||null},t._setActive=function(t){return this._activePopup=t,this},t.getActive=function(){return this._activePopup||this.getTopMost()},t.setLocale=function(t,n,e){var i,o,r,s;for(null==e&&(e=!0),this.locale[t]=n,s=this._popups,i=0,o=s.length;o>i;i++)r=s[i],r.redraw();return this},t.getLocale=function(t,n){return null!=n?this.locale[t][n]||null:this.locale[t]},t.registerPopup=function(t){return n.call(this._popups,t)<0&&this._popups.push(t),this},t.unregisterPopup=function(t){var n,e;return this._popups=function(){var i,o,r,s;for(r=this._popups,s=[],n=i=0,o=r.length;o>i;n=++i)e=r[n],e!==t&&s.push(e);return s}.call(this),this},t["new"]=function(t,n,e){return null==e&&(e={}),new this(t,n,e)},t.prototype._setAsActive=function(){return this.constructor._setActive(this),this},t.prototype.show=function(t){return this.div.fadeIn(FADE_TIME,t),this},t.prototype.hide=function(t){return this.div.fadeOut(FADE_TIME,t),this},t.prototype.showOverlay=function(t){return this.overlay.fadeIn(FADE_TIME,t),this},t.prototype.hideOverlay=function(t){return this.overlay.fadeOut(FADE_TIME,t),this},t.prototype.showLoader=function(){return this.loader.fadeIn(FADE_TIME),this},t.prototype.hideLoader=function(){return this.loader.fadeOut(FADE_TIME),this},t.prototype.fireAction=function(){var t,n,i;if(n=arguments[0],i=2<=arguments.length?e.call(arguments,1):[],n=n.toUpperCase(),null!=(t=this.constructor.ACTIONS[n]))return t.apply(this,i);throw new Error("Popup::fireAction: No action with name '"+n+"' found!")},t.prototype.close=function(t){var n;return null==t&&(t=!1),!t&&this.beforeClose instanceof Function&&this.beforeClose()===!1?!1:(n=this,this.hide(function(){return n.div.remove(),!0}),this.hideOverlay(function(){return n.overlay.remove(),!0}),this.constructor.unregisterPopup(this),t||"function"==typeof this.onClose&&this.onClose(),this)},t.prototype.remove=function(){return this.close.apply(this,arguments)},t.prototype.changeContent=function(t,n,e){var i,o;if(i=$('<div class="body" style="width: '+(this.bodyWidth-this.bodyPadding.left-this.bodyPadding.right)+'px;" />'),o=this.contents[e],null==o)throw new Error("StateMachineBox::changeContent: No content given for '"+e+"'!");return null==this.bodyWrapper&&(this.bodyWrapper=this.div.find(".bodyWrapper")),i.append(o),"back"===t?this.bodyWrapper.prepend(i).css("margin-left","-"+this.bodyWidth+"px").animate({"margin-left":"0px"},400,"swing",function(){return $(this).children().eq(1).detach(),!0}):"none"!==n&&this.bodyWrapper.append(i).animate({"margin-left":"-"+this.bodyWidth+"px"},400,"swing",function(){return $(this).children().eq(0).detach(),$(this).css("margin-left","0px"),!0}),this},t.prototype.currentContent=function(){return this.contents[this.current]},t.prototype.draw=function(){var t,n,e,i,o,r,s,a,h,c,u,l;if(this.constructor.MODE===this.constructor.MODES.SINGLE&&null!=this.constructor.getActive())return console.warn("Popup::draw: tried to draw more than 1 popup but mode is set to 'single'!"),this;for(l=this,s=this.headline?'<div class="header companyBGColor">\n    <div class="headline noselect">'+this.headline+"</div>\n</div>":"",this.div.empty().append('<div class="content">\n    <div class="close" />\n    <div class="loader" />\n    '+s+'\n    <div class="bodyWrapper" />\n    <div class="navigation" />\n    <div class="footer" />\n</div>'),this.div.find(".overlay, .close").click(function(){return l.fireAction(l.closeButtonAction),!0}),this.div.mousedown(function(){return l._setAsActive(),!0}),this.navigation=this.div.find(".navigation"),this.loader=this.div.find(".loader"),this.footer=this.div.find(".footer"),o=this.options.buttons||[],a=h=0,u=o.length;u>h;a=++h)if(i=o[a],null!=i){if(t=null,"string"==typeof i)n=i.toUpperCase(),i=this.constructor.BUTTONS[n],t=this.constructor.ACTIONS[this.constructor.BUTTON_ACTIONS[n]];else{if(null==i.button||null==i.action){console.warn("Invalid button configuration for Popup!");continue}n=i,i=this.constructor.BUTTONS[n.button.toUpperCase()],t=this.constructor.ACTIONS[n.action.toUpperCase()]}null!=t&&(i=$(i),c=this.constructor.BUTTON_COLORS[a],i.css({"background-color":c}),function(t){return i.click(function(){return t.call(l),!0})}(t),this.footer.append(i))}if(this.footer.css("background-color",c),l=this,this.showNavigation||this.navigation.addClass("hidden"),this.init(),r=this.contents[this.current],null==r)throw new Error("StateMachineBox::draw: No content found for '"+this.current+"'!");return e=$('<div class="body" style="width: '+(this.bodyWidth-this.bodyPadding.left-this.bodyPadding.right)+'px;" />'),e.append(r),this.bodyWrapper.append(e),this.constructor.MODE===this.constructor.MODES.MANY?this.div.draggable({handle:".header"}).addClass("draggable"):this.constructor.MODE===this.constructor.MODES.SINGLE&&this.container.append(this.overlay.click(function(){return l.fireAction("cancel"),!0})),this.container.append(this.div),this._setAsActive(),this},t.prototype.redraw=function(){return this},t.prototype.fireEvent=function(){var t,n;return t=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],this[t]instanceof Function?(this[t].apply(this,n),this):(console.warn("StateStatePopup::fireEvent: There is no event called '"+t+"'! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure(t),this)},t.prototype.next=function(){var t,n,e,i,o;if(this.beforeNext instanceof Function&&this.beforeNext()===!1)return!1;for(n=[],o=this.stateMachineConfig.events,e=0,i=o.length;i>e;e++)t=o[e],t.from===this.current&&"back"!==t.name&&n.push(t);return 1===n.length?(this.fireEvent(n.first.name),this):0===n.length?(console.warn("StateMachineBox::next: There is no event for '"+this.current+"'! Can't go any further! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure("next"),this):(console.warn("StateMachineBox::next: More than 1 event for '"+this.current+"': ["+function(){var e,i,o;for(o=[],e=0,i=n.length;i>e;e++)t=n[e],o.push(t.name);return o}()+"]! Can't decide where to go! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure("next"),this)},t.prototype.prev=function(){var t;if(this.beforePrev instanceof Function&&this.beforePrev()===!1)return!1;try{return this.back(),this}catch(n){return t=n,console.warn("StateMachineBox::prev: Cannot go to 'prev' because no back route was defined! Define it with '{ name: 'back', from: 'prevState', to: 'returnState' }' ;) Use onFailure() to catch that!"),console.warn(t),"function"==typeof this.onFailure&&this.onFailure("prev"),this}},t.prototype.change=function(t){var n,e,i,o;if(this.beforeChange instanceof Function&&this.beforeChange(idx)===!1)return!1;for(o=this.stateMachineConfig.events,e=0,i=o.length;i>e;e++)if(n=o[e],n.from===this.current&&n.to===t)return this.fireEvent(n.name),this.onChange instanceof Function&&this.onChange.call(this,n.from,t),this;return console.warn("StateMachineBox::change: Cannot go to '"+t+"' from '"+this.current+"'! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure("change"),this},t}(),StateMachineBox.init(),t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n}(StateMachineBox)}).call(this);