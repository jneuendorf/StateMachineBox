(function(){var t,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},e=[].slice,o=function(t,n){function e(){this.constructor=t}for(var o in n)i.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;window.StateMachineBox=function(){function t(t,n,o){var i,s,r,a,c;for(null==o&&(o={}),this.headline=n,this.options=o,this.closeButtonAction=o.closeButtonAction||"close",this.onClose=o.onClose,this.onOk=o.onOk,this.onCancel=o.onCancel,this.onNext=o.onNext,this.onPrev=o.onPrev,this.onChange=o.onChange,this.beforeClose=o.beforeClose,this.beforeNext=o.beforeNext,this.beforePrev=o.beforePrev,this.beforeChange=o.beforeChange,this.onFailure=o.onFailure,this.theme=o.theme||"default",this.locale=o.locale||"en",this.showNavigation=o.showNavigation||!1,this.container=o.container||$(document.body),this.data={},this.div=this.constructor._$cache.popup.clone(),this.overlay=this.constructor._$cache.overlay.clone(),null!=o.width&&null!=o.height&&this.div.css({width:o.width,height:o.height}),this.loader=null,this.bodyWidth=parseFloat(this.options.width)||800,this.bodyPadding={top:10,right:40,bottom:10,left:40},this._active=!1,t.target=this,this.stateMachineConfig=t,this.bodyWrapper=null,this.contents={},a=t.events,s=0,r=a.length;r>s;s++)i=a[s],null!=i.content&&(this.contents[i.to]=i.content);c=this,null==t.callbacks&&(t.callbacks={}),t.callbacks.onenterstate=function(){var t,n,o,i;return t=arguments[0],n=arguments[1],i=arguments[2],o=4<=arguments.length?e.call(arguments,3):[],console.log("onenterstate",arguments),c.beforeChange instanceof Function&&c.beforeChange(i)===!1?!1:(c._changeContent(t,n,i),c.onChange(t,n,i),!0)},StateMachine.create(t),this.constructor._registerPopup(this)}return t.MODES={SINGLE:"single",MANY:"many"},t.MODE=t.MODES.SINGLE,t.FADE_TIME=180,t.DEFAULT_CSS_CLASS="default",t.BUTTON_ACTIONS={OK:"CLOSE",CANCEL:"CANCEL",NEXT:"NEXT",PREV:"PREV"},t.BUTTONS={OK:'<div class="button ok locale" data-langkey="ok" />',CANCEL:'<div class="button cancel locale" data-langkey="cancel" />',NEXT:'<div class="button next locale" data-langkey="next" />',PREV:'<div class="button prev locale" data-langkey="prev" />'},t.ACTIONS={CLOSE:function(){return this.close()},OK:function(){return this.close(!0),this.onOk instanceof Function&&this.onOk(),this},CANCEL:function(){return this.close(!0),this.onCancel instanceof Function&&this.onCancel(),this},CHANGE:function(t){return this.change(t)},NEXT:function(){return this.next()},PREV:function(){return this.prev()}},t.BUTTON_COLORS=["#222222","#9FA39F","#B9BCB9","#D3D5D3"],t._popups=[],t._activePopup=null,t._$cache={popup:$('<div class="popup">\n    <div class="content">\n        <div class="close" />\n        <div class="loader" />\n        <div class="header">\n            <div class="headline" />\n        </div>\n        <div class="bodyWrapper" />\n        <div class="navigation" />\n        <div class="footer" />\n    </div>\n</div>'),overlay:$('<div class="popup overlay" />'),buttons:{ok:$('<div class="button ok" data-langkey="ok" />'),cancel:$('<div class="button cancel" data-langkey="cancel" />'),next:$('<div class="button next" data-langkey="next" />'),prev:$('<div class="button prev" data-langkey="prev" />')}},t.locale={},t.init=function(){return this.setLocale("en",{ok:"ok",cancel:"cancel",next:"next",prev:"previous"}),this.setLocale("de",{ok:"ok",cancel:"abbrechen",next:"weiter",prev:"zurÃ¼ck"}),this},t.getTopMost=function(){var t,n,e,o,i;for(i=this._popups,t=$(),n=0,e=i.length;e>n;n++)o=i[n],t=t.add(o.div);return i[t.index(t.filter(":visible:last"))]||null},t._setActive=function(t){return this._activePopup=t,this},t.getActive=function(){return this._activePopup||this.getTopMost()},t.setLocale=function(t,n,e){var o,i,s,r;if(null==e&&(e=!0),this.locale[t]=n,e===!0)for(r=this._popups,o=0,i=r.length;i>o;o++)s=r[o],s.redraw();return this},t.getLocale=function(t,n){return null!=n?this.locale[t][n]||null:this.locale[t]},t.deleteLocale=function(t){return delete this.locale[t],this},t._registerPopup=function(t){return n.call(this._popups,t)<0&&this._popups.push(t),this},t._unregisterPopup=function(t){var n,e;return this._popups=function(){var o,i,s,r;for(s=this._popups,r=[],n=o=0,i=s.length;i>o;n=++o)e=s[n],e!==t&&r.push(e);return r}.call(this),this},t["new"]=function(t,n,e){return null==e&&(e={}),new this(t,n,e)},t.prototype._setAsActive=function(){return this.constructor._setActive(this),this},t.prototype.show=function(t){return this.div.fadeIn(this.constructor.FADE_TIME,t),this},t.prototype.hide=function(t){return this.div.fadeOut(this.constructor.FADE_TIME,t),this},t.prototype.showOverlay=function(t){return this.overlay.fadeIn(this.constructor.FADE_TIME,t),this},t.prototype.hideOverlay=function(t){return this.overlay.fadeOut(this.constructor.FADE_TIME,t),this},t.prototype.showLoader=function(){return this.loader.fadeIn(this.constructor.FADE_TIME),this},t.prototype.hideLoader=function(){return this.loader.fadeOut(this.constructor.FADE_TIME),this},t.prototype.fireAction=function(){var t,n,o;return n=arguments[0],o=2<=arguments.length?e.call(arguments,1):[],n=n.toUpperCase(),null!=(t=this.constructor.ACTIONS[n])?t.apply(this,o):null},t.prototype.close=function(t){var n;return null==t&&(t=!1),!t&&this.beforeClose instanceof Function&&this.beforeClose()===!1?!1:(n=this,this.hide(function(){return n.div.remove(),!0}),this.hideOverlay(function(){return n.overlay.remove(),!0}),this.constructor._unregisterPopup(this),t||"function"==typeof this.onClose&&this.onClose(),this)},t.prototype.remove=function(){return this.close.apply(this,arguments)},t.prototype._changeContent=function(t,n,e){var o,i;if(o=$('<div class="body" style="width: '+(this.bodyWidth-this.bodyPadding.left-this.bodyPadding.right)+'px;" />'),i=this.contents[e],null==i)throw new Error("StateMachineBox::_changeContent: No content given for '"+e+"'!");return null==this.bodyWrapper&&(this.bodyWrapper=this.div.find(".bodyWrapper")),o.append(i),"back"===t?this.bodyWrapper.prepend(o).css("margin-left","-"+this.bodyWidth+"px").animate({"margin-left":"0px"},400,"swing",function(){return $(this).children().eq(1).detach(),!0}):"none"!==n&&this.bodyWrapper.append(o).animate({"margin-left":"-"+this.bodyWidth+"px"},400,"swing",function(){return $(this).children().eq(0).detach(),$(this).css("margin-left","0px"),!0}),this},t.prototype.currentContent=function(){return this.contents[this.current]},t.prototype.draw=function(){var t,n,e,o,i,s,r,a,c,h,l,u;if(this.constructor.MODE===this.constructor.MODES.SINGLE&&null!=this.constructor.getActive())return console.warn("Popup::draw: tried to draw more than 1 popup but mode is set to 'single'!"),this;for(u=this,r=this.headline?'<div class="header companyBGColor">\n    <div class="headline noselect">'+this.headline+"</div>\n</div>":"",this.div.empty().append('<div class="content">\n    <div class="close" />\n    <div class="loader" />\n    '+r+'\n    <div class="bodyWrapper" />\n    <div class="navigation" />\n    <div class="footer" />\n</div>'),this.div.find(".overlay, .close").click(function(){return u.fireAction(u.closeButtonAction),!0}),this.div.mousedown(function(){return u._setAsActive(),!0}),this.navigation=this.div.find(".navigation"),this.loader=this.div.find(".loader"),this.footer=this.div.find(".footer"),i=this.options.buttons||[],a=c=0,l=i.length;l>c;a=++c)o=i[a],null!=o&&(t=null,"string"==typeof o?(n=o.toUpperCase(),o=this.constructor._$cache.buttons[n].clone(),t=this.constructor.ACTIONS[this.constructor.BUTTON_ACTIONS[n]]):null!=o.button&&null!=o.action&&(n=o,o=this.constructor._$cache.buttons[n.button.toUpperCase()].clone(),t=this.constructor.ACTIONS[n.action.toUpperCase()]),null!=t&&(h=this.constructor.BUTTON_COLORS[a],o.css({"background-color":h}),function(t){return o.click(function(){return t.call(u),!0})}(t),this.footer.append(o)));if(this.footer.css("background-color",h),u=this,this.showNavigation||this.navigation.addClass("hidden"),this.init(),s=this.contents[this.current],null==s)throw new Error("StateMachineBox::draw: No content found for '"+this.current+"'!");return e=$('<div class="body" style="width: '+(this.bodyWidth-this.bodyPadding.left-this.bodyPadding.right)+'px;" />'),e.append(s),this.bodyWrapper.append(e),this.constructor.MODE===this.constructor.MODES.MANY?this.div.draggable({handle:".header"}).addClass("draggable"):this.constructor.MODE===this.constructor.MODES.SINGLE&&this.container.append(this.overlay.click(function(){return u.fireAction("cancel"),!0})),this.container.append(this.div),this._setAsActive(),this},t.prototype.redraw=function(){var t,n,e,o;t=this.div.find(".locale"),e=this.contructor.getLocale(this.locale);for(n in e)o=e[n],t.filter('[data-langkey="'+n+'"]').text(o);return this},t.prototype.fireEvent=function(){var t,n;return t=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],this[t]instanceof Function?(this[t].apply(this,n),this):(console.warn("StateStatePopup::fireEvent: There is no event called '"+t+"'! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure(t),this)},t.prototype.next=function(){var t,n,e,o,i;if(this.beforeNext instanceof Function&&this.beforeNext()===!1)return this;for(n=[],i=this.stateMachineConfig.events,e=0,o=i.length;o>e;e++)t=i[e],t.from===this.current&&"back"!==t.name&&n.push(t);return 1===n.length?(this.fireEvent(n.first.name),this):0===n.length?(console.warn("StateMachineBox::next: There is no event for '"+this.current+"'! Can't go any further! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure("next"),this):(console.warn("StateMachineBox::next: More than 1 event for '"+this.current+"': ["+function(){var e,o,i;for(i=[],e=0,o=n.length;o>e;e++)t=n[e],i.push(t.name);return i}()+"]! Can't decide where to go! Use onFailure() to catch that!"),"function"==typeof this.onFailure&&this.onFailure("next"),this)},t.prototype.prev=function(){var t;if(this.beforePrev instanceof Function&&this.beforePrev()===!1)return this;try{return this.back(),this}catch(n){return t=n,console.warn("StateMachineBox::prev: Cannot go to 'prev' because no back route was defined! Define it with '{ name: 'back', from: 'prevState', to: 'returnState' }' ;) Use onFailure() to catch that!"),console.warn(t),"function"==typeof this.onFailure&&this.onFailure("prev"),this}},t}(),StateMachineBox.init(),t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n}(StateMachineBox)}).call(this);